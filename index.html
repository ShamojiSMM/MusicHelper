<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" href="images/favicon.ico">

  <link rel="stylesheet" href="style.css" type="text/css">
  <script src="midiParser.js" defer></script>
  <script src="data.js" defer></script>
  <script src="script.js" defer></script>

  <title>レール演奏補助ツール</title>

  <meta name="google-site-verification" content="FF-jl08IpYvT8gR51LfziGsiz1AkfHZpXcCUrOLdWMQ">
</head>

<body>
  <main>
    <header>
      <h1>
        レール演奏補助ツール
        <a href="https://x.com/Shamoji_SMM" target="_blank">
          <img src="images/xIcon.jpg" title="made by @Shamoji_SMM">
        </a>
      </h1>

      <div>
        <p class="pText">現在改装中です。集音生成機能のみ。</p>
        <p class="pDescription gray">Last Update: 2025/Feb/17</p>
      </div>
    </header>

    <hr>
    <section>
      <h2>集音生成</h2>
      <p class="pSubH">羽あり地上/水中、羽なし地上の縦断線式集音。</p><br>

      <label class="labelInput">
        集音タイプ:
        <select id="selectType">
          <option value="wing-ground" selected>羽あり, 地上</option>
          <option value="noWing-ground">羽なし, 地上</option>
          <option value="wing-water">羽あり, 水中</option>
          <option value="noWing-water">羽なし, 水中</option>
        </select>
      </label><br>

      <label class="labelInput">
        MIDIファイル:
        <input id="inputSmf" type="file" accept=".midi, .mid, .smf">
      </label>

      <label class="labelInput">
        トラック:
        <select id="selectTrack"></select>
      </label><br>

      <label class="labelInput spaceBottom">
        <button id="buttonLoadSmf">読み込み</button>
      </label><br>

      <label class="labelInput">
        4分音価:
        <input id="inputTickUnit" type="number" value="480" step="1" min="1">
      </label><br>

      <label class="labelInput spaceRight">
        4分符長[f]:
        <input id="inputBeatValue" type="number" step="any">
      </label>

      <p class="pResult">
        BPM:
        <span id="spanBpm"></span>
      </p><br>

      <label class="labelInput">
        基準音:
        <select id="selectBaseKey"></select>
      </label>

      <label class="labelInput spaceRight">
        <button id="buttonPlay">演奏</button>
      </label>

      <label class="labelInput">
        音色:
        <select id="selectInstrument">
          <option>正弦波</option>
          <option>三角波</option>
          <option selected>矩形波</option>
          <option>ノコギリ波</option>
        </select>
      </label>

      <label class="labelInput">
        <button id="buttonStopPlay">演奏停止</button>
      </label>

      <div class="divScroll">
        <table id="table0">
          <tr><th>番号</th></tr>
          <tr><th>メモ</th></tr>
          <tr><th title="">
            <label class="labelInput">
              <select id="selectNoteInput">
                <option selected title="音の長さ。4分符2つ分の長さなら、(4分音価) * 2 となる。">音価</option>
                <option title="(2)=2分音符, (8.)=付点8分音符, (4..+8-16)=複付点4分音符+8分音符-16分音符=2分音符">n分符</option>
              </select>
            </label>
          </th></tr>
          <tr><th title="音の長さ。">符長[f]</th></tr>
          <tr><th title="基準音からの音程の差(半音単位)。">音高[b]</th></tr>
        </table>
      </div>

      <label class="labelInput">
        <button id="buttonCalcTable0">ここまで計算</button>
      </label><br>

      <label class="labelInput">
        読み込みタイプ:
        <select id="selectLoading">
          <option selected>開始画面(全て同時)</option>
          <option>自由落下</option>
          <option>縦スクロール</option>
          <option>横スクロール</option>
        </select>
      </label>

      <label class="labelInput invisible">
        <select id="selectLoadingInput">
          <option>カスタム</option>
          <option selected>平均遅度</option>
          <option>遅度循環</option>
        </select>
      </label><br>

      <label class="labelInput invisible">
        平均スクロール遅度[f/b]:
        <input id="inputScrollSlownessAve" type="number" step="any">
      </label>

      <label class="labelInput invisible">
        スクロール遅度循環[f/b]:
        <input id="inputScrollSlownessCycle" type="text" placeholder="e.g. 6, 7, 6, 6, 7">
      </label>

      <label class="labelInput">
        着線パターン:
        <select id="selectLanding">
          <option>カスタム</option>
        </select>
      </label>

      <div class="divScroll">
        <table id="table1">
          <tr><th>番号</th></tr>
          <tr><th>メモ</th></tr>
          <tr><th title="基準音が鳴ってからその音が鳴るまでの時間。">時刻[f]</th></tr>
          <tr><th title="前列と比べたときの、音符ブロックが移動する分の遅延。">列間遅延[f]</th></tr>
          <tr class="invisible"><th title="前列と比べたときの、スクロールでの遅延。">横ス遅延[f]</th></tr>
          <tr><th title="基準列の音符ブロックとの高さの差。">y差[b]</th></tr>
        </table>
      </div>

      <label class="labelInput spaceRight">
        基準遅延[f]:
        <input id="inputBaseDelay" type="number" step="1">
      </label>

      <label class="labelInput">
        基準高さ[b]:
        <input id="inputBaseHeight" type="number" step="1" min="0">
      </label><br>

      <label class="labelInput spaceRight">
        <button id="buttonSortWirings">集音する</button>
      </label>

      <p class="pResult">
        <span id="spanEvals"></span>
      </p>

      <div class="divScroll">
        <table id="table2">
          <tr><th>番号</th></tr>
          <tr><th>メモ</th></tr>
          <tr><th title="その列に与える遅延。">遅延[f]</th></tr>
          <tr><th title="集音レールとの距離。">高さ[b]</th></tr>
          <tr><th title="◎: ±0, ○: ±1, △: ±2, ×: それ超過。">配置可</th></tr>
          <tr><th title="セルを押すと下側に表示。">表示</th></tr>
        </table>
      </div>

      <label class="labelInput spaceRight">
        <button id="buttonChangeOverview">全体像を表示/非表示</button>
      </label>

      <p class="pResult">
        <span id="spanWiringData"></span>
      </p><br>

      <div id="divOverview" class="invisible">
        <canvas id="canvasOverview"></canvas>
        <canvas id="canvasOverviewSelect"></canvas>
      </div>

    </section>

    <hr>
    <section>
      <h2>縦断線式集音配線生成</h2>
      <p class="pSubH">縦レールによる集音(ぜんまいメソッド)の配置を探します。</p><br>

      <canvas id="canvasWiring" width="32"></canvas>

      <div id="divWiring">
        <label class="labelInput spaceRight">
          遅延[f]:
          <input id="inputWiringDelay" type="number" step="1">
        </label>

        <label class="labelInput">
          高さ[b]:
          <input id="inputWiringHeight" type="number" step="1" min="1">
        </label><br>

        <label class="labelInput spaceRight">
          タイプ:
          <select id="selectWiringType"></select>
        </label>

        <label class="labelInput">
          着線時の形状:
          <select id="selectWiringLanding"></select>
        </label><br>

        <label class="labelInput spaceRight">
          <button id="buttonFindWiring">探す</button>
        </label>

        <label class="labelInput">
          <select id="selectWiringOrder">
            <option selected>↑長さ 短い順</option>
            <option>↑長さ 長い順</option>
            <option>↓長さ 短い順</option>
            <option>↓長さ 長い順</option>
          </select>
        </label>

        <label class="labelInput">
          <input id="checkWiringView" type="checkbox" checked>
          実行時に画像表示
        </label><br>

        <p class="pResult">
          一致:<br>
          <span class="spanWiringResults"></span>
        </p><br>

        <p class="pResult">
          誤差:<br>
          <span class="spanWiringResults"></span>
        </p><br>

        <p class="pResult">
          もっと誤差:<br>
          <span class="spanWiringResults"></span>
        </p>
      </div>
    </section>

    <hr>
    <section>
      <h2>画像</h2><br>

      <img src="images/info/gaps.png" alt="gaps" height="180">
      <img src="images/info/height.png" alt="height" height="180"><br>

      <img src="images/info/landing.png" alt="landing patterns" height="240">
    </section>
  </main>
</body>
</html>
